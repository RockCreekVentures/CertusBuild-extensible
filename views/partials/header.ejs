<header>
    <div class="container">
        <div id="branding">
            <a href="/"><img src="/assets/logo.svg" alt="CertusBuild Logo"></a>
        </div>
        <nav>
            <ul>
                <li class="<%= activeLink === 'home' ? 'current' : '' %>"><a href="/">Home</a></li>
                <li class="<%= activeLink === 'research' ? 'current' : '' %>"><a href="/research">Research Archive</a></li>
                <li class="<%= activeLink === 'pitch_materials' ? 'current' : '' %>"><a href="/pitch-materials">Pitch Materials</a></li>
                <li class="<%= activeLink === 'utilities' ? 'current' : '' %>"><a href="/utilities">Utilities</a></li>
                <li class="<%= activeLink === 'about' ? 'current' : '' %>"><a href="/about">About</a></li>
                
                <% if (typeof isAuthenticated !== 'undefined' && isAuthenticated) { %>
                    <li class="user-profile dropdown">
                        <a href="#" class="dropdown-toggle" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-1"></i>
                            <%= user.name || user.preferred_username || user.sub || 'User' %>
                            <i class="fas fa-chevron-down ms-1"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="/auth/logout"><i class="fas fa-sign-out-alt me-2"></i>Log Out</a></li>
                        </ul>
                    </li>
                <% } else { %>
                    <li><a href="/auth/login"><i class="fas fa-sign-in-alt me-1"></i> Log In</a></li>
                <% } %>
            </ul>
        </nav>
    </div>
</header>

<style>
    .user-profile {
        margin-left: 20px;
    }
    
    .dropdown-toggle {
        cursor: pointer;
    }
    
    .dropdown-menu {
        min-width: 200px;
        padding: 0.5rem 0;
        margin-top: 8px;
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }
    
    .dropdown-item {
        padding: 0.5rem 1rem;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize dropdowns
        const dropdownToggleList = document.querySelectorAll('.dropdown-toggle');
        if (dropdownToggleList.length > 0) {
            dropdownToggleList.forEach(function(dropdownToggle) {
                dropdownToggle.addEventListener('click', function(event) {
                    event.preventDefault();
                    const parent = this.parentNode;
                    parent.classList.toggle('show');
                    const dropdownMenu = parent.querySelector('.dropdown-menu');
                    if (dropdownMenu) {
                        dropdownMenu.classList.toggle('show');
                    }
                });
            });
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', function(event) {
                const dropdowns = document.querySelectorAll('.dropdown');
                dropdowns.forEach(function(dropdown) {
                    if (!dropdown.contains(event.target)) {
                        dropdown.classList.remove('show');
                        const menu = dropdown.querySelector('.dropdown-menu');
                        if (menu) {
                            menu.classList.remove('show');
                        }
                    }
                });
            });
        }
    });
</script>